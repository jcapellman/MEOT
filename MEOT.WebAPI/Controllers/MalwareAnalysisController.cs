using MEOT.lib.Containers;
using MEOT.lib.Managers;

using MEOT.WebAPI.Controllers.Base;

using Microsoft.AspNetCore.Mvc;

namespace MEOT.WebAPI.Controllers
{
    public class MalwareAnalysisController : BaseController
    {
        private MalwareManager _manager;

        public MalwareAnalysisController(MalwareManager manager)
        {
            _manager = manager;
        }

        // GET: api/MalwareAnalysis/query
        [HttpGet("{query}")]
        public MalwareAnalysisContainer Get(string query)
        {
            var malware = _manager.GetMalwareQuery(query);

            if (malware == null)
            {
                return null;
            }

            return new MalwareAnalysisContainer
            {
                malware = malware,
                malwareCheckpoint = _manager.GetCheckpoint(malware.Id),
                vendorBreakdown = _manager.GetVendorCheckpoints(malware.Id)
            };
        }
    }
}