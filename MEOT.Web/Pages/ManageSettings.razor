@page "/Settings"

@using MEOT.lib.Managers
@using MEOT.lib.Objects

@inject SettingsManager settingManager

<h1>Settings</h1>

<EditForm Model="@model" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <p>
        <label>
            Hours Between Checks
        
            <InputNumber id="intervalforchecks" @bind-Value="model.HoursBetweenChecks" />
        </label>
    </p>
    
    <h3>SMTP Settings</h3>
    
    <p>
        <label>
            SMTP Server Address
        
            <InputText id="smtpserver" @bind-Value="model.SMTPAddress" />
        </label>
    </p>
    
    <p>
        <label>
            SMTP Server Port
        
            <InputNumber id="smtpport" @bind-Value="model.SMTPPort" />
        </label>
    </p>
    
    <p>
        <label>
            SMTP Server Username
        
            <InputText id="smtpuser" @bind-Value="model.SMTPUser" />
        </label>
    </p>
    
    <p>
        <label>
            SMTP Server Password
        
            <InputText id="smtppassword" @bind-Value="model.SMTPPassword" />
        </label>
    </p>

    <h3>Source License Keys</h3>
    @foreach (var source in model.Sources)
    {
        <p>
            <label>
                @source.Key
                
                <input id="@source.Key" @bind="model.Sources[source.Key]" size="80" />
                
            </label>
        </p>
    }

    <button type="submit" class="btn btn-primary btn-rounded"><i class="bi-save"></i>&nbsp; Save</button>
</EditForm>

@code {
    private Settings model = new Settings();
    
    protected override void OnInitialized()
    {
        model = settingManager.GetSettings();
    }

    private void HandleValidSubmit()
    {
        settingManager.SaveSettings(model);
    }
}