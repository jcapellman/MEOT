@page "/AddEditMalware"
@page "/AddEditMalware/{id}"

@using MEOT.lib.DAL.Base
@using MEOT.lib.Objects

@inject IDAL db
@inject NavigationManager NavManager

@if (!IsNew)
{
    <h1>Edit Tracked Malware</h1>
}
else
{
    <h1>Add New Tracked Malware</h1>
}

<EditForm Model="@model" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />
    
    <p>
        <label>
            Malware Name
        
            <InputText id="name" @bind-Value="model.Name" />
        </label>
    </p>
    
    <p>
        <label>
            SHA1
        
            <InputText id="sha1" @bind-Value="model.SHA1" />
        </label>
    </p>
    
    <p>
        <label>
            File Format

            <InputText id="format" @bind-Value="model.Format"/>
        </label>
    </p>
    
    <p>
        <label>
            Enabled for Active Monitoring
    
            <InputCheckbox id="enabled" @bind-Value="model.Enabled" />
        </label>
    </p>

    <button type="submit" class="btn-primary">Save</button>
</EditForm>

@code {
    [Parameter]
    public string id { get; set; }

    private bool IsNew;

    private Malware model = new Malware();

    protected override void OnInitialized()
    {
        IsNew = string.IsNullOrEmpty(id);

        if (IsNew)
        {
            return;
        }

        model = db.SelectOne<Malware>(Convert.ToInt32(id));
    }

    private void HandleValidSubmit()
    {
        if (IsNew)
        {
            db.Insert(model);
        }
        else
        {
            db.Update(model);
        }

        NavManager.NavigateTo("/ManageMalware");
    }
}