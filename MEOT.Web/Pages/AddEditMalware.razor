@page "/AddEditMalware"
@page "/AddEditMalware/{id}"

@using MEOT.lib.Managers
@using MEOT.lib.Objects

@inject MalwareManager malwareManager
@inject NavigationManager NavManager

@inherits BaseRazorPage

@if (!IsNew)
{
    <h1>Edit Tracked Malware</h1>
}
else
{
    <h1>Add New Tracked Malware</h1>
}

<EditForm Model="@model" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />
    
    <p>
        <label>
            Malware Name
        
            <InputText id="name" @bind-Value="model.Name" />
        </label>
    </p>
    
    <p>
        <label>
            SHA1
        
            <InputText id="sha1" @bind-Value="model.SHA1" />
        </label>
    </p>
    
    <p>
        <label>
            Day Zero
        
            <InputDate id="dayzero" @bind-Value="model.DayZero" />
        </label>
    </p>
    
    <p>
        <label>
            File Format

            <InputText id="format" @bind-Value="model.Format"/>
        </label>
    </p>
    
    <p>
        <label>
            Enabled for Active Monitoring
    
            <InputCheckbox id="enabled" @bind-Value="model.Enabled" />
        </label>
    </p>

    <button type="submit" class="btn btn-primary btn-rounded"><i class="bi-save"></i>&nbsp; Save</button>
</EditForm>

@code {
    [Parameter]
    public string id { get; set; }

    private bool IsNew;

    private Malware model = new Malware();

    protected override void OnInitialized()
    {
        if (!IsAuthenticated)
        {
            RedirectHome(NavManager);

            return;
        }

        IsNew = string.IsNullOrEmpty(id);

        if (IsNew)
        {
            return;
        }

        model = malwareManager.GetMalwareById(Convert.ToInt32(id));
    }

    private void HandleValidSubmit()
    {
        malwareManager.CreateOrUpdate(model, IsNew);

        NavManager.NavigateTo("/ManageMalware");
    }
}