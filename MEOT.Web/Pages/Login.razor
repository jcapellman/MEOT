@page "/Login"

@using MEOT.lib.Managers
@using MEOT.lib.Objects

@inject UserManager userManager
@inject NavigationManager NavManager

@inherits BaseRazorPage

<div class="col-lg-4 col-md-4 col-sm-4 container justify-content-center">
    <div class="jumbotron my-auto">
        <h3>MEOT Login</h3>

        <EditForm Model="@model" OnValidSubmit="@HandleValidSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary />
    
            @if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <div class="alert alert-danger">
                    @ErrorMessage
                </div>
            }

            <p>
                <label>
                    Email Address<br/>
        
                    <InputText id="emailaddress" type="email" @bind-Value="model.EmailAddress" />
                </label>
            </p>
    
            <p>
                <label>
                    Password<br/>
        
                    <InputText id="password" type="password" @bind-Value="model.Password" />
                </label>
            </p>
    
            <button type="submit" class="btn btn-primary btn-rounded"><i class="bi-box-arrow-right"></i>&nbsp; Login</button>
        </EditForm>
    </div>
</div>

@code {
    private User model = new User();

    private string ErrorMessage { get; set; }

    private async void HandleValidSubmit()
    {
        ErrorMessage = userManager.AttemptLogin(model);

        if (!string.IsNullOrEmpty(ErrorMessage))
        {
            return;
        }

        await LoginAsync(model);

        NavManager.NavigateTo("/");
    }
}
